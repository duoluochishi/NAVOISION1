<Window x:Class="NV.CT.ImageViewer.View.StudyFilterWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:NV.CT.ImageViewer.View"
        mc:Ignorable="d"
        xmlns:md="clr-namespace:MaterialDesignThemes.Wpf.Controls.MarkableTextBox;assembly=MaterialDesignThemes.Wpf"
        xmlns:res="clr-namespace:NV.CT.Language;assembly=NV.CT.Language"
         Background="Transparent" ResizeMode="NoResize" AllowsTransparency="True"
        WindowStyle="None"
        xmlns:converter="clr-namespace:NV.CT.UI.Controls.Converter;assembly=NV.CT.UI.Controls"
        xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
        Title="StudyFilterWindow" Height="450" Width="1200">
	<Window.Resources>
		<converter:BoolToStyleConverter x:Key="boolToStyleConverter" />
		<converter:PatientTypeStyleConverter x:Key="patientTypeStyleConverter" />
		<converter:WorkflowStatusStyleConverter x:Key="workflowStatusStyleConverter" />
	</Window.Resources>
	<Border CornerRadius="10" Style="{StaticResource WindowsBorder}">
		<Grid>
			<Grid.RowDefinitions>
				<RowDefinition Height="35" />
				<RowDefinition Height="100" />
				<RowDefinition Height="*" />
			</Grid.RowDefinitions>
			<Border Style="{StaticResource WindowContentBorder}" />
			<Grid Grid.Row="0">
				<Grid.ColumnDefinitions>
					<ColumnDefinition />
					<ColumnDefinition />
				</Grid.ColumnDefinitions>
				<TextBlock Style="{StaticResource TileTextBlock}" Text="{x:Static res:LanguageResource.Content_Filter}" />
				<Button Grid.Column="1" Style="{StaticResource TileCloseButtonStyle}" ToolTip="{x:Static res:LanguageResource.Content_Close}"
                        Command="{Binding  Commands[CloseCommand]}" 
                        CommandParameter="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType=Window}}">
					<Path Style="{StaticResource TileClosePathStyle}" />
				</Button>
			</Grid>
			<!--查询部分-->
			<Grid Grid.Row="1">
				<Grid.RowDefinitions>
					<RowDefinition></RowDefinition>
					<RowDefinition></RowDefinition>
				</Grid.RowDefinitions>	
				<Grid Grid.Row="0">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="110"></ColumnDefinition>
						<ColumnDefinition Width="200"></ColumnDefinition>
						<ColumnDefinition Width="100"></ColumnDefinition>
						<ColumnDefinition Width="200"></ColumnDefinition>
						<ColumnDefinition Width="*"></ColumnDefinition>
					</Grid.ColumnDefinitions>
					<Grid Grid.Column="0" VerticalAlignment="Center">
						<TextBlock Text="PID" Margin="15 0"></TextBlock>
					</Grid>
					<Grid Grid.Column="1">
						<md:MarkableTextBox  MaxLength="30" Uid="txtFirstName" Style="{StaticResource WithValidationMarkableTextBox}">
							<TextBox.Text>
								<Binding Path="PatientId" UpdateSourceTrigger="PropertyChanged" ValidatesOnDataErrors="True"/>
							</TextBox.Text>
						</md:MarkableTextBox>
					</Grid>
					<Grid Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Center">
						<TextBlock Text="Body part"></TextBlock>
					</Grid>
					<Grid Grid.Column="3">
						<ComboBox Grid.Row="0"  HorizontalAlignment="Left" VerticalContentAlignment="Center" Style="{StaticResource MaterialDesignOutlinedComboBox}" Width="200"
						          ItemsSource="{Binding BodyParts}" SelectedItem="{Binding BodyPart}">
						</ComboBox>
					</Grid>
					<Grid Grid.Column="4">
						<TextBlock Foreground="Red" Text="{Binding ErrorMsg}" Margin="0 0 20 0" HorizontalAlignment="Right" VerticalAlignment="Center"></TextBlock>
					</Grid>
				</Grid>
				<Grid Grid.Row="1">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="110"></ColumnDefinition>
						<ColumnDefinition Width="200"></ColumnDefinition>
						<ColumnDefinition Width="100"></ColumnDefinition>
						<ColumnDefinition Width="200"></ColumnDefinition>
						<ColumnDefinition Width="*"></ColumnDefinition>
					</Grid.ColumnDefinitions>
					<Grid Grid.Column="0" VerticalAlignment="Center">
						<TextBlock Text="Study date" Margin="15 0"></TextBlock>
					</Grid>
					<Grid Grid.Column="1">
						<DatePicker HorizontalAlignment="Left" VerticalContentAlignment="Center" Style="{StaticResource MaterialDesignOutlinedDatePicker}" Width="200">
							<DatePicker.SelectedDate>
								<Binding Path="StartDate" ValidatesOnDataErrors="True" />
							</DatePicker.SelectedDate>
						</DatePicker>
					</Grid>
					<Grid Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Center">
						<TextBlock Text="~" Margin="20,0,20,0" Style="{StaticResource InputLabelTextBlock}" />
					</Grid>
					<Grid Grid.Column="3">
						<DatePicker HorizontalAlignment="Left" VerticalContentAlignment="Center" Style="{StaticResource MaterialDesignOutlinedDatePicker}" Width="200">
							<DatePicker.SelectedDate>
								<Binding Path="EndDate" ValidatesOnDataErrors="True" />
							</DatePicker.SelectedDate>
						</DatePicker>
					</Grid>
					<StackPanel  Grid.Column="4" VerticalAlignment="Center" Orientation="Horizontal" HorizontalAlignment="Right">
							<Button VerticalContentAlignment="Center" Margin="0 0 20 0" Width="90" Height="30" VerticalAlignment="Center"
							        Content="Search" Command="{Binding Commands[SearchCommand]}">
							</Button>
							<Button Width="90" Height="30" VerticalContentAlignment="Center" Margin="0 0 60 0"
							        Content="{x:Static res:LanguageResource.Content_Cancel}" >
								<i:Interaction.Triggers>
									<i:EventTrigger EventName="Click">
										<i:InvokeCommandAction Command="{Binding Commands[CloseCommand]}" CommandParameter="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType=Window}}" />
									</i:EventTrigger>
								</i:Interaction.Triggers>
							</Button>
						<Button VerticalContentAlignment="Center" Margin="0 0 20 0" Width="90" Height="30" VerticalAlignment="Center"
						        Content="Confirm">
							<i:Interaction.Triggers>
								<i:EventTrigger EventName="Click">
									<i:InvokeCommandAction Command="{Binding Commands[ConfirmCommand]}" CommandParameter="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType=Window}}" />
								</i:EventTrigger>
							</i:Interaction.Triggers>
						</Button>
					</StackPanel>
				</Grid>
			</Grid>

			<DataGrid x:Name="DgStudy" Grid.Row="2" ItemsSource="{Binding VStudies}" SelectedItem="{Binding SelectedItem, Mode=TwoWay}" SelectionMode="Single"
          Style="{StaticResource CommonDataGrid}">
				<DataGrid.Columns>
					<DataGridTemplateColumn Width="*" MinWidth="160" Header="{x:Static res:LanguageResource.Header_Name}">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<Grid>
									<Grid.ColumnDefinitions>
										<ColumnDefinition Width="22" />
										<ColumnDefinition />
									</Grid.ColumnDefinitions>
									<Path Margin="6,0,0,0" Width="15" Height="15" HorizontalAlignment="Left" VerticalAlignment="Center"
                              ToolTip="{Binding PatientTypeString}" 
                              Style="{Binding PatientType, Converter={StaticResource patientTypeStyleConverter}}"/>
									<TextBlock Grid.Column="1" Margin="5,0,10,0" Text="{Binding PatientName}"
                                   Style="{StaticResource DataGridContentTextBlock}"/>
								</Grid>
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
					</DataGridTemplateColumn>
					<DataGridTemplateColumn Width="*" MinWidth="200" Header="{x:Static res:LanguageResource.Header_PatientId}">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<TextBlock Text="{Binding PatientId}" Margin="0,0,10,0"
                               Style="{StaticResource DataGridContentTextBlock}" />
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
					</DataGridTemplateColumn>
					<DataGridTemplateColumn Width="auto" MinWidth="80" Header="{x:Static res:LanguageResource.Header_Birthday}">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<TextBlock Text="{Binding Birthday, StringFormat='yyyy/MM/dd'}" Margin="0,0,10,0"
                        Style="{StaticResource DataGridContentTextBlock}"/>
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
					</DataGridTemplateColumn>
					<DataGridTemplateColumn Width="auto" MinWidth="50" Header="{x:Static res:LanguageResource.Header_Sex}">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<TextBlock Text="{Binding PatientSexString}" HorizontalAlignment="Left" Margin="0,0,10,0"
                               Style="{StaticResource DataGridContentTextBlock}" />
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
					</DataGridTemplateColumn>
					<DataGridTemplateColumn Width="auto" MinWidth="80" Header="{x:Static res:LanguageResource.Header_BodyPart}">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<TextBlock Text="{Binding BodyPart}" HorizontalAlignment="Left" Margin="0,0,00,0"
                               Style="{StaticResource DataGridContentTextBlock}" />
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
					</DataGridTemplateColumn>
					<DataGridTemplateColumn Width="auto" MinWidth="80" Header="{x:Static res:LanguageResource.Header_Study_Status}">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<Path Width="22" Height="22" Margin="30,0,0,0" Stretch="Uniform" HorizontalAlignment="Left" VerticalAlignment="Center"  
                          Style="{Binding StudyStatus, Converter={StaticResource workflowStatusStyleConverter}}"/>
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
					</DataGridTemplateColumn>
					<DataGridTemplateColumn Width="auto" MinWidth="180" Header="{x:Static res:LanguageResource.Header_Study_Time}">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<TextBlock Text="{Binding ExamStartTime, StringFormat='yyyy/MM/dd HH:mm:ss'}" Margin="0,0,10,0"
                               Style="{StaticResource DataGridContentTextBlock}"/>
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
					</DataGridTemplateColumn>
					<DataGridTemplateColumn Width="auto" MinWidth="100" Header="{x:Static res:LanguageResource.Header_CreatedTime}">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<TextBlock Text="{Binding CreateTime, StringFormat='yyyy/MM/dd HH:mm:ss'}"
                               Style="{StaticResource DataGridContentTextBlock}"/>
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
					</DataGridTemplateColumn>

				</DataGrid.Columns>
				<i:Interaction.Triggers>
					<i:EventTrigger EventName="SelectedCellsChanged">
						<i:InvokeCommandAction
                Command="{Binding Commands[SelectionChangedCommand]}"
                CommandParameter="{Binding SelectedItems, ElementName=DgStudy}" />
					</i:EventTrigger>
				</i:Interaction.Triggers>
			</DataGrid>

		</Grid>
	</Border>
</Window>
