<UserControl
    x:Class="NV.CT.Service.ComponentHistory.Views.ComponentHistoryView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:mk="clr-namespace:MaterialDesignThemes.Wpf.Controls.MarkableTextBox;assembly=MaterialDesignThemes.Wpf"
    xmlns:enums="clr-namespace:NV.CT.Service.ComponentHistory.Enums"
    xmlns:models="clr-namespace:NV.CT.Service.ComponentHistory.Models"
    xmlns:viewModels="clr-namespace:NV.CT.Service.ComponentHistory.ViewModels"
    mc:Ignorable="d"
    x:Name="Root"
    d:DesignHeight="450"
    d:DesignWidth="1500"
    d:DataContext="{d:DesignInstance Type=viewModels:ComponentHistoryViewModel}"
    Loaded="Root_Loaded">
    <UserControl.Resources>
        <Style x:Key="WaitPath" TargetType="{x:Type Path}">
            <Setter Property="Width" Value="20" />
            <Setter Property="Fill" Value="Gray" />
            <Setter Property="Stretch" Value="Uniform" />
            <Setter Property="Data" Value="M12 19C13.1 19 14 19.9 14 21S13.1 23 12 23 10 22.1 10 21 10.9 19 12 19M12 1C13.1 1 14 1.9 14 3S13.1 5 12 5 10 4.1 10 3 10.9 1 12 1M6 16C7.1 16 8 16.9 8 18S7.1 20 6 20 4 19.1 4 18 4.9 16 6 16M3 10C4.1 10 5 10.9 5 12S4.1 14 3 14 1 13.1 1 12 1.9 10 3 10M6 4C7.1 4 8 4.9 8 6S7.1 8 6 8 4 7.1 4 6 4.9 4 6 4M18 16C19.1 16 20 16.9 20 18S19.1 20 18 20 16 19.1 16 18 16.9 16 18 16M21 10C22.1 10 23 10.9 23 12S22.1 14 21 14 19 13.1 19 12 19.9 10 21 10M18 4C19.1 4 20 4.9 20 6S19.1 8 18 8 16 7.1 16 6 16.9 4 18 4Z" />
        </Style>
        <Style x:Key="WarnPath" TargetType="{x:Type Path}">
            <Setter Property="Width" Value="20" />
            <Setter Property="Fill" Value="Yellow" />
            <Setter Property="Stretch" Value="Uniform" />
            <Setter Property="Data" Value="M13,13H11V7H13M13,17H11V15H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z" />
        </Style>
    </UserControl.Resources>
    <Grid IsEnabled="{Binding IsBusing, Converter={StaticResource InvertBooleanConverter}}">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="auto" MinWidth="250" />
            <ColumnDefinition Width="5" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <ListBox
            x:Name="ComponentCategoriesListBox"
            Grid.Column="0"
            BorderThickness="1"
            BorderBrush="{DynamicResource BaseTabBackBrush}"
            SelectedItem="{Binding SelectedComponentCategory}"
            HorizontalContentAlignment="Stretch"
            ItemsSource="{Binding ComponentCategories}">
            <ListBox.ItemTemplate>
                <DataTemplate DataType="{x:Type models:ComponentCategoryModel}">
                    <DockPanel LastChildFill="False">
                        <TextBlock
                            DockPanel.Dock="Left"
                            VerticalAlignment="Center"
                            Text="{Binding Name}" />
                        <StackPanel
                            Margin="10 0 0 0"
                            DockPanel.Dock="Right"
                            GotFocus="ListBoxItemGotFocus"
                            Orientation="Horizontal">
                            <Button
                                Margin="5 0 0 0"
                                Width="30"
                                Height="30"
                                ToolTip="Refresh"
                                Command="{Binding DataContext.RefreshCategoryCommand, ElementName=Root}"
                                CommandParameter="{Binding}">
                                <md:PackIcon Kind="Refresh" />
                            </Button>
                            <Button
                                Margin="5 0 0 0"
                                Width="30"
                                Height="30"
                                ToolTip="Update"
                                Command="{Binding DataContext.UpdateCategoryCommand, ElementName=Root}"
                                CommandParameter="{Binding}">
                                <md:PackIcon Kind="Download" />
                            </Button>
                            <Button
                                Margin="5 0 0 0"
                                Width="30"
                                Height="30"
                                ToolTip="History"
                                Click="ButtonHistory_Click">
                                <md:PackIcon Kind="ClipboardTextHistoryOutline" />
                            </Button>
                        </StackPanel>
                    </DockPanel>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
        <Border Grid.Column="2" BorderThickness="1" BorderBrush="{DynamicResource BaseTabBackBrush}">
            <ScrollViewer Margin="5">
                <ItemsControl
                    Grid.IsSharedSizeScope="True"
                    HorizontalAlignment="Center"
                    ItemsSource="{Binding SelectedItem.Entries, ElementName=ComponentCategoriesListBox}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.Resources>
                        <DataTemplate x:Key="EntryItemDateTemplate" DataType="{x:Type models:ComponentEntryItemModel}">
                            <Border
                                Padding="5"
                                Margin="5 2"
                                CornerRadius="5"
                                BorderThickness="1"
                                BorderBrush="{DynamicResource BaseTabBackBrush}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="auto" SharedSizeGroup="ColumnName" />
                                        <ColumnDefinition Width="auto" />
                                        <ColumnDefinition Width="*" SharedSizeGroup="ColumnSN" />
                                        <ColumnDefinition Width="auto" />
                                        <ColumnDefinition Width="auto" />
                                        <ColumnDefinition Width="auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock
                                        Grid.Column="0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center"
                                        Text="{Binding Name}" />
                                    <TextBlock
                                        Grid.Column="1"
                                        VerticalAlignment="Center"
                                        Text=" Series Number : " />
                                    <mk:MarkableTextBox
                                        Grid.Column="2"
                                        MinWidth="350"
                                        IsReadOnly="True"
                                        IsReadOnlyCaretVisible="True"
                                        VerticalAlignment="Center"
                                        VerticalContentAlignment="Center"
                                        Text="{Binding LocalSN, Mode=OneWay}" />
                                    <TextBlock
                                        Grid.Column="3"
                                        Margin="5 0 0 0"
                                        VerticalAlignment="Center"
                                        Text="Install Time : " />
                                    <TextBlock
                                        Grid.Column="4"
                                        VerticalAlignment="Center"
                                        Text="{Binding InstallTime, StringFormat={}{0:yyyy-MM-dd HH:mm:ss}}" />
                                    <StackPanel
                                        Grid.Column="5"
                                        Margin="10 0 0 0"
                                        Orientation="Horizontal">
                                        <Border Background="Transparent" ToolTip="{Binding ReadDeviceSNStr, Mode=OneWay}">
                                            <Path d:Style="{StaticResource WrongPath}">
                                                <i:Interaction.Triggers>
                                                    <i:DataTrigger Binding="{Binding ReadDeviceSNStatus}" Value="{x:Static enums:ReadDeviceSNStatus.Reading}">
                                                        <i:ChangePropertyAction PropertyName="Style" Value="{StaticResource WaitPath}" />
                                                    </i:DataTrigger>
                                                    <i:DataTrigger Binding="{Binding ReadDeviceSNStatus}" Value="{x:Static enums:ReadDeviceSNStatus.Identical}">
                                                        <i:ChangePropertyAction PropertyName="Style" Value="{StaticResource RightPath}" />
                                                    </i:DataTrigger>
                                                    <i:DataTrigger Binding="{Binding ReadDeviceSNStatus}" Value="{x:Static enums:ReadDeviceSNStatus.Different}">
                                                        <i:ChangePropertyAction PropertyName="Style" Value="{StaticResource WarnPath}" />
                                                    </i:DataTrigger>
                                                    <i:DataTrigger Binding="{Binding ReadDeviceSNStatus}" Value="{x:Static enums:ReadDeviceSNStatus.Error}">
                                                        <i:ChangePropertyAction PropertyName="Style" Value="{StaticResource WrongPath}" />
                                                    </i:DataTrigger>
                                                </i:Interaction.Triggers>
                                            </Path>
                                        </Border>
                                        <Button
                                            Margin="5 0 0 0"
                                            Width="30"
                                            Height="30"
                                            ToolTip="Refresh"
                                            Command="{Binding DataContext.RefreshEntryItemCommand, ElementName=Root}"
                                            CommandParameter="{Binding}">
                                            <md:PackIcon Kind="Refresh" />
                                        </Button>
                                        <Button
                                            Margin="5 0 0 0"
                                            Width="30"
                                            Height="30"
                                            ToolTip="Update"
                                            IsEnabled="{Binding IsCanUpdate, Mode=OneWay}"
                                            Command="{Binding DataContext.UpdateEntryItemCommand, ElementName=Root}"
                                            CommandParameter="{Binding}">
                                            <md:PackIcon Kind="Download" />
                                        </Button>
                                        <Button
                                            Margin="5 0 0 0"
                                            Width="30"
                                            Height="30"
                                            ToolTip="History"
                                            Click="ButtonHistory_Click">
                                            <md:PackIcon Kind="ClipboardTextHistoryOutline" />
                                        </Button>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                        <DataTemplate DataType="{x:Type models:ComponentSingleEntryModel}">
                            <ContentControl Content="{Binding EntryItem}" ContentTemplate="{StaticResource EntryItemDateTemplate}" />
                        </DataTemplate>
                        <DataTemplate DataType="{x:Type models:ComponentModuleEntryModel}">
                            <Border
                                Padding="5"
                                Margin="2"
                                CornerRadius="5"
                                BorderThickness="1"
                                BorderBrush="{DynamicResource BaseTabBackBrush}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="auto" />
                                        <RowDefinition />
                                    </Grid.RowDefinitions>
                                    <TextBlock
                                        Grid.Row="0"
                                        HorizontalAlignment="Center"
                                        Text="{Binding Name}" />
                                    <ItemsControl
                                        Grid.Row="1"
                                        ItemTemplate="{StaticResource EntryItemDateTemplate}"
                                        ItemsSource="{Binding EntryItems}" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.Resources>
                </ItemsControl>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>