<UserControl
    x:Class="NV.CT.Service.TubeHistory.Views.TubeHistoryView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:mk="clr-namespace:MaterialDesignThemes.Wpf.Controls.MarkableTextBox;assembly=MaterialDesignThemes.Wpf"
    xmlns:viewModels="clr-namespace:NV.CT.Service.TubeHistory.ViewModels"
    xmlns:views="clr-namespace:NV.CT.Service.TubeHistory.Views"
    mc:Ignorable="d"
    x:Name="Root"
    d:DesignHeight="450"
    d:DesignWidth="1800"
    d:DataContext="{d:DesignInstance Type=viewModels:TubeHistoryViewModel}"
    Loaded="Root_Loaded">
    <UserControl.Resources>
        <Style x:Key="CenterStyle" TargetType="{x:Type TextBlock}">
            <Setter Property="HorizontalAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>
        <DataTemplate x:Key="DataGridColumnHeaderCenterDataTemplate">
            <TextBlock TextAlignment="Center" VerticalAlignment="Center" Text="{Binding}" />
        </DataTemplate>
        <Style TargetType="{x:Type DataGridColumnHeader}" BasedOn="{StaticResource {x:Type DataGridColumnHeader}}">
            <Setter Property="HorizontalContentAlignment" Value="Center" />
        </Style>
        <Style TargetType="{x:Type DataGridCell}" BasedOn="{StaticResource {x:Type DataGridCell}}">
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Padding" Value="2" />
        </Style>
        <Style TargetType="{x:Type DataGrid}" BasedOn="{StaticResource {x:Type DataGrid}}">
            <Setter Property="AutoGenerateColumns" Value="False" />
            <Setter Property="CanUserAddRows" Value="False" />
            <Setter Property="CanUserDeleteRows" Value="False" />
            <Setter Property="CanUserReorderColumns" Value="False" />
            <Setter Property="CanUserResizeRows" Value="False" />
            <Setter Property="CanUserSortColumns" Value="False" />
            <Setter Property="IsReadOnly" Value="True" />
        </Style>
    </UserControl.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition MinWidth="50" Width="auto" />
            <ColumnDefinition Width="10" />
            <ColumnDefinition MinWidth="50" />
        </Grid.ColumnDefinitions>
        <GroupBox Grid.Column="0" Header="Overview" Width="auto">
            <DataGrid ItemsSource="{Binding TubeOverviewItems}" d:ItemsSource="{d:SampleData ItemCount=24}">
                <DataGrid.Columns>
                    <DataGridTextColumn
                        Header="Tube No"
                        MinWidth="50"
                        ElementStyle="{StaticResource CenterStyle}"
                        Binding="{Binding TubeNo}" />
                    <DataGridTemplateColumn Header="Tube SN" MinWidth="50">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <mk:MarkableTextBox
                                    IsReadOnly="True"
                                    IsReadOnlyCaretVisible="True"
                                    HorizontalContentAlignment="Center"
                                    VerticalContentAlignment="Center"
                                    TextAlignment="Center"
                                    Background="Transparent"
                                    Foreground="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type DataGrid}}}"
                                    Text="{Binding TubeSN}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn
                        Header="Total Exposure&#13;Time (ms)"
                        HeaderTemplate="{StaticResource DataGridColumnHeaderCenterDataTemplate}"
                        MinWidth="50"
                        ElementStyle="{StaticResource CenterStyle}"
                        Binding="{Binding TotalExposureTime, StringFormat={}{0:0.###}}" />
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>
        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Center" />
        <GroupBox Grid.Column="2" Header="Detail">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="5" />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <Border
                    Grid.Row="0"
                    CornerRadius="10"
                    Padding="5"
                    BorderThickness="1"
                    BorderBrush="#5a5a89">
                    <Border.Resources>
                        <SolidColorBrush x:Key="PrimaryHueMidForegroundBrush" Color="#FFFFFFFF" />
                    </Border.Resources>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition />
                            <RowDefinition Height="5" />
                            <RowDefinition />
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal">
                            <!--#region Time -->
                            <CheckBox IsChecked="{Binding Filter.IsTimeChecked}" />
                            <TextBlock
                                Margin="5 0 0 0"
                                VerticalAlignment="Center"
                                Text="{Binding Filter.StartTime, StringFormat='Time {0:yyyy-MM-dd HH:mm:ss}'}" />
                            <md:DialogHost Margin="5 0 0 0" Placement="RelativePoint">
                                <Button Width="35" Command="{x:Static md:DialogHost.OpenDialogCommand}">
                                    <Button.CommandParameter>
                                        <Border
                                            CornerRadius="5"
                                            BorderThickness="1"
                                            BorderBrush="#5a5a89">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="*" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>
                                                <Calendar
                                                    Grid.Column="0"
                                                    Grid.Row="0"
                                                    Margin="1 -1 0 0"
                                                    SelectedDate="{Binding Filter.StartTime}" />
                                                <md:Clock
                                                    Grid.Column="1"
                                                    Grid.Row="0"
                                                    Is24Hours="True"
                                                    DisplayAutomation="CycleWithSeconds"
                                                    Time="{Binding Filter.StartTime}" />
                                                <Button
                                                    Grid.Column="0"
                                                    Grid.Row="1"
                                                    Grid.ColumnSpan="2"
                                                    Margin="0 0 5 5"
                                                    HorizontalAlignment="Right"
                                                    Style="{StaticResource CommonButton}"
                                                    Command="{x:Static md:DialogHost.CloseDialogCommand}"
                                                    Content="OK" />
                                            </Grid>
                                        </Border>
                                    </Button.CommandParameter>
                                    <md:PackIcon Kind="Calendar" VerticalAlignment="Center" />
                                </Button>
                            </md:DialogHost>
                            <TextBlock
                                Margin="5 0 0 0"
                                VerticalAlignment="Center"
                                Text="{Binding Filter.EndTime, StringFormat='— {0:yyyy-MM-dd HH:mm:ss}'}" />
                            <md:DialogHost Margin="5 0 0 0" Placement="RelativePoint">
                                <Button Width="35" Command="{x:Static md:DialogHost.OpenDialogCommand}">
                                    <Button.CommandParameter>
                                        <Border
                                            CornerRadius="5"
                                            BorderThickness="1"
                                            BorderBrush="#5a5a89">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="*" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>
                                                <Calendar
                                                    Grid.Column="0"
                                                    Grid.Row="0"
                                                    Margin="1 -1 0 0"
                                                    SelectedDate="{Binding Filter.EndTime}" />
                                                <md:Clock
                                                    Grid.Column="1"
                                                    Grid.Row="0"
                                                    Is24Hours="True"
                                                    DisplayAutomation="CycleWithSeconds"
                                                    Time="{Binding Filter.EndTime}" />
                                                <Button
                                                    Grid.Column="0"
                                                    Grid.Row="1"
                                                    Grid.ColumnSpan="2"
                                                    Margin="0 0 5 5"
                                                    HorizontalAlignment="Right"
                                                    Style="{StaticResource CommonButton}"
                                                    Command="{x:Static md:DialogHost.CloseDialogCommand}"
                                                    Content="OK" />
                                            </Grid>
                                        </Border>
                                    </Button.CommandParameter>
                                    <md:PackIcon Kind="Calendar" VerticalAlignment="Center" />
                                </Button>
                            </md:DialogHost>
                            <!--#endregion-->

                            <!--#region Micro Arcing Count -->
                            <CheckBox
                                Margin="10 0 0 0"
                                IsChecked="{Binding Filter.IsMicroArcingCountChecked}" />
                            <TextBlock
                                Margin="5 0 0 0"
                                VerticalAlignment="Center"
                                Text="Micro Arcing Count" />
                            <ComboBox
                                Margin="5 0 0 0"
                                Width="70"
                                HorizontalContentAlignment="Center"
                                DisplayMemberPath="Value"
                                SelectedValuePath="Key"
                                SelectedValue="{Binding Filter.MicroArcingCompareType}"
                                ItemsSource="{Binding CompareDic}" />
                            <mk:MarkableTextBox
                                Margin="5 0 0 0"
                                Width="80"
                                Text="{Binding Filter.MicroArcingCount}" />
                            <!--#endregion-->

                            <!--#region Big Arcing Count -->
                            <CheckBox
                                Margin="10 0 0 0"
                                IsChecked="{Binding Filter.IsBigArcingCountChecked}" />
                            <TextBlock
                                Margin="5 0 0 0"
                                VerticalAlignment="Center"
                                Text="Big Arcing Count" />
                            <ComboBox
                                Margin="5 0 0 0"
                                Width="70"
                                HorizontalContentAlignment="Center"
                                DisplayMemberPath="Value"
                                SelectedValuePath="Key"
                                SelectedValue="{Binding Filter.BigArcingCompareType}"
                                ItemsSource="{Binding CompareDic}" />
                            <mk:MarkableTextBox
                                Margin="5 0 0 0"
                                Width="80"
                                Text="{Binding Filter.BigArcingCount}" />
                            <!--#endregion-->
                        </StackPanel>
                        <StackPanel Grid.Row="2" Orientation="Horizontal">
                            <!--#region Tube No -->
                            <CheckBox IsChecked="{Binding Filter.IsTubeNoChecked}" />
                            <TextBlock
                                Margin="5 0 0 0"
                                VerticalAlignment="Center"
                                Text="Tube No" />
                            <ComboBox
                                Margin="5 0 0 0"
                                Width="70"
                                HorizontalContentAlignment="Center"
                                SelectedItem="{Binding Filter.TubeNo}"
                                ItemsSource="{Binding TubeNoArray}" />
                            <!--#endregion-->

                            <!--#region Tube SN -->
                            <CheckBox
                                Margin="10 0 0 0"
                                IsChecked="{Binding Filter.IsTubeSNChecked}" />
                            <TextBlock
                                Margin="5 0 0 0"
                                VerticalAlignment="Center"
                                Text="Tube SN" />
                            <mk:MarkableTextBox
                                Margin="5 0 0 0"
                                Width="300"
                                Text="{Binding Filter.TubeSN}" />
                            <!--#endregion-->

                            <Button
                                Margin="10 0 0 0"
                                Padding="20 0"
                                Content="Search"
                                Command="{Binding SearchCommand}" />
                        </StackPanel>
                    </Grid>
                </Border>
                <DataGrid Grid.Row="2" ItemsSource="{Binding DetailItems}" d:ItemsSource="{d:SampleData ItemCount=24}">
                    <DataGrid.Resources>
                        <Style TargetType="{x:Type ToolTip}" BasedOn="{StaticResource {x:Type ToolTip}}">
                            <Setter Property="Background" Value="#5a5a89" />
                        </Style>
                    </DataGrid.Resources>
                    <DataGrid.Columns>
                        <DataGridTextColumn
                            Header="Scan Time"
                            MinWidth="30"
                            ElementStyle="{StaticResource CenterStyle}"
                            Binding="{Binding ScanTime, StringFormat={}{0:yyyy-MM-dd HH:mm:ss}}" />
                        <DataGridTextColumn
                            Header="Tube No"
                            MinWidth="30"
                            ElementStyle="{StaticResource CenterStyle}"
                            Binding="{Binding TubeNo}" />
                        <DataGridTemplateColumn Header="Tube SN" MinWidth="30">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <mk:MarkableTextBox
                                        IsReadOnly="True"
                                        IsReadOnlyCaretVisible="True"
                                        HorizontalContentAlignment="Center"
                                        VerticalContentAlignment="Center"
                                        TextAlignment="Center"
                                        Background="Transparent"
                                        Foreground="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type DataGrid}}}"
                                        Text="{Binding TubeSN}" />
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTemplateColumn Header="Scan Params" MinWidth="30">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock
                                        Margin="3 0"
                                        TextAlignment="Left"
                                        VerticalAlignment="Center"
                                        Foreground="{Binding Foreground, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type DataGrid}}}"
                                        Text="{Binding ScanParamStr}">
                                        <TextBlock.ToolTip>
                                            <views:ScanParamsToolTip />
                                        </TextBlock.ToolTip>
                                    </TextBlock>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn
                            Header="Dose Infos"
                            MinWidth="30"
                            ElementStyle="{StaticResource CenterStyle}">
                            <DataGridTextColumn.Binding>
                                <MultiBinding StringFormat=" {0:0.###}kV、{1:0.###}mA、{2:0.###}ms">
                                    <Binding Path="KVDose" />
                                    <Binding Path="MADose" />
                                    <Binding Path="ExposureTimeDose" />
                                </MultiBinding>
                            </DataGridTextColumn.Binding>
                        </DataGridTextColumn>
                        <DataGridTextColumn
                            Header="Views"
                            MinWidth="30"
                            ElementStyle="{StaticResource CenterStyle}"
                            Binding="{Binding Views}" />
                        <DataGridTextColumn
                            Header="Micro&#13;Arcing"
                            HeaderTemplate="{StaticResource DataGridColumnHeaderCenterDataTemplate}"
                            MinWidth="30"
                            ElementStyle="{StaticResource CenterStyle}"
                            Binding="{Binding MicroArcingCountStr}" />
                        <DataGridTextColumn
                            Header="Big&#13;Arcing"
                            HeaderTemplate="{StaticResource DataGridColumnHeaderCenterDataTemplate}"
                            MinWidth="30"
                            ElementStyle="{StaticResource CenterStyle}"
                            Binding="{Binding BigArcingCountStr}" />
                        <DataGridTextColumn
                            Header="HeatCap &amp; OilTemp&#13;(Before Scan)"
                            HeaderTemplate="{StaticResource DataGridColumnHeaderCenterDataTemplate}"
                            MinWidth="30"
                            ElementStyle="{StaticResource CenterStyle}">
                            <DataGridTextColumn.Binding>
                                <MultiBinding StringFormat=" {0:F1}、{1:F1}">
                                    <Binding Path="HeatCapBeforeScan" />
                                    <Binding Path="OilTempBeforeScan" />
                                </MultiBinding>
                            </DataGridTextColumn.Binding>
                        </DataGridTextColumn>
                        <DataGridTextColumn
                            Header="HeatCap &amp; OilTemp&#13;(After Scan)"
                            HeaderTemplate="{StaticResource DataGridColumnHeaderCenterDataTemplate}"
                            MinWidth="30"
                            ElementStyle="{StaticResource CenterStyle}">
                            <DataGridTextColumn.Binding>
                                <MultiBinding StringFormat=" {0:F1}、{1:F1}">
                                    <Binding Path="HeatCapAfterScan" />
                                    <Binding Path="OilTempAfterScan" />
                                </MultiBinding>
                            </DataGridTextColumn.Binding>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </GroupBox>
    </Grid>
</UserControl>