<dialog:BaseCustomWindow
    x:Class="NV.CT.Service.Common.MapUI.SetCollectionWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:attachedProperty="clr-namespace:NV.CT.Service.Common.AttachedProperty"
    xmlns:converters="clr-namespace:NV.CT.Service.Common.Converters"
    xmlns:selectors="clr-namespace:NV.CT.Service.Common.MapUI.DataTemplateSelectors"
    xmlns:dialog="clr-namespace:NV.MPS.UI.Dialog;assembly=NV.MPS.UI.Dialog"
    mc:Ignorable="d"
    Title="{Binding Title}"
    Height="400"
    MinWidth="300"
    SizeToContent="Width"
    WindowStartupLocation="CenterOwner">
    <Window.Resources>
        <converters:StringToNullableConverter x:Key="StringToNullableConverter" />
        <DataTemplate x:Key="SimpleCollectionDataTemplate">
            <TextBox
                MinWidth="100"
                VerticalContentAlignment="Center"
                GotFocus="Control_GotFocus"
                attachedProperty:TextBoxAttachedProperty.UpdateSourceWhenEnter="True"
                Text="{Binding Value, Mode=TwoWay, Converter={StaticResource StringToNullableConverter}}" />
        </DataTemplate>
        <DataTemplate x:Key="EnumCollectionDataTemplate">
            <ComboBox
                MinWidth="200"
                VerticalContentAlignment="Center"
                GotFocus="Control_GotFocus"
                DisplayMemberPath="Key"
                SelectedValuePath="Value"
                SelectedValue="{Binding Value}"
                ItemsSource="{Binding DataContext.EnumDic, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ItemsControl}}}" />
        </DataTemplate>
        <selectors:CollectionMapUIDataTemplateSelector
            x:Key="CollectionMapUIDataTemplateSelector"
            SimpleCollectionTemplate="{StaticResource SimpleCollectionDataTemplate}"
            EnumCollectionTemplate="{StaticResource EnumCollectionDataTemplate}" />
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>
        <ListBox
            Grid.Row="0"
            Margin="10"
            HorizontalContentAlignment="Stretch"
            ItemTemplateSelector="{StaticResource CollectionMapUIDataTemplateSelector}"
            SelectedItem="{Binding SelectedItem}"
            ItemsSource="{Binding Values}" />
        <StackPanel
            Grid.Row="1"
            Margin="10 0 10 10"
            Orientation="Horizontal"
            HorizontalAlignment="Right">
            <Button
                Padding="10 0"
                Content="Add"
                Command="{Binding AddCommand}" />
            <Button
                Margin="10 0"
                Padding="10 0"
                Content="Delete"
                Command="{Binding DeleteCommand}"
                CommandParameter="{Binding SelectedItem}" />
            <Button
                Padding="10 0"
                Content="Close"
                IsCancel="True"
                Click="Button_Click" />
        </StackPanel>
    </Grid>
</dialog:BaseCustomWindow>